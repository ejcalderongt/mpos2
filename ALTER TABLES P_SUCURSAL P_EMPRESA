ALTER TABLE P_EMPRESA 
ADD CLAVE NVARCHAR(20) NULL

ALTER TABLE P_SUCURSAL
ADD CODIGO_PROVEEDOR INT NULL

INSERT INTO P_PROVEEDOR 
SELECT 'S' + CONVERT(NVARCHAR(10),CODIGO), EMPRESA, NOMBRE, 1
FROM P_SUCURSAL

UPDATE P_SUCURSAL SET CODIGO_PROVEEDOR = 
                       (SELECT P.CODIGO_PROVEEDOR 
					    FROM P_PROVEEDOR P 
					    WHERE P.CODIGO = 'S' + CONVERT(NVARCHAR(10),P_SUCURSAL.CODIGO))
              
ALTER TABLE P_SUCURSAL
ALTER COLUMN CODIGO_PROVEEDOR INT NOT NULL

ALTER TABLE [dbo].[P_SUCURSAL]  WITH CHECK ADD  CONSTRAINT [FK_P_SUCURSAL_P_PROVEEDOR] FOREIGN KEY([CODIGO_PROVEEDOR])
REFERENCES [dbo].[P_PROVEEDOR] ([CODIGO_PROVEEDOR])
GO

ALTER TABLE [dbo].[P_SUCURSAL] CHECK CONSTRAINT [FK_P_SUCURSAL_P_PROVEEDOR]
GO

